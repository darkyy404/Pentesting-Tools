import os
import re

# Función para validar si la entrada es una IP o un dominio
def validar_ip_dominio(objetivo):
    ip_regex = r"^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$"
    dominio_regex = r"^([a-zA-Z0-9-]{1,63}\.)+[a-zA-Z]{2,6}$"
    return re.match(ip_regex, objetivo) or re.match(dominio_regex, objetivo)

# Función para realizar el escaneo con Nmap
def ejecutar_comando_nmap(comando, descripcion):
    print(f"\nEjecutando: {descripcion}...")
    resultado = os.popen(comando).read()  # Captura el resultado del comando
    print(resultado)
    return resultado

# Funciones para diferentes tipos de escaneos
def escaneo_rapido(objetivo):
    if validar_ip_dominio(objetivo):
        ejecutar_comando_nmap(f"nmap -T4 -F {objetivo}", "Escaneo rápido de puertos")

def escaneo_completo(objetivo):
    if validar_ip_dominio(objetivo):
        ejecutar_comando_nmap(f"nmap -p- {objetivo}", "Escaneo completo de puertos")

def escaneo_sistemas_operativos(objetivo):
    if validar_ip_dominio(objetivo):
        ejecutar_comando_nmap(f"nmap -O {objetivo}", "Detección de sistemas operativos")

def escaneo_vulnerabilidades(objetivo):
    if validar_ip_dominio(objetivo):
        ejecutar_comando_nmap(f"nmap --script vuln {objetivo}", "Escaneo de vulnerabilidades básicas")

# Función principal para el menú interactivo
def menu():
    print("\n--- Menú de Escaneo Nmap ---")
    print("1. Escaneo rápido de puertos")
    print("2. Escaneo completo de puertos")
    print("3. Detección de sistemas operativos")
    print("4. Escaneo de vulnerabilidades")
    print("5. Salir")
    
    opcion = input("\nSelecciona una opción: ")
    if opcion in ['1', '2', '3', '4']:
        objetivo = input("Ingresa la dirección IP o dominio objetivo: ")
        
        if opcion == '1':
            escaneo_rapido(objetivo)
        elif opcion == '2':
            escaneo_completo(objetivo)
        elif opcion == '3':
            escaneo_sistemas_operativos(objetivo)
        elif opcion == '4':
            escaneo_vulnerabilidades(objetivo)
    elif opcion == '5':
        print("Saliendo del programa...")
        exit()
    else:
        print("Opción no válida. Inténtalo de nuevo.")

if __name__ == "__main__":
    while True:
        menu()
